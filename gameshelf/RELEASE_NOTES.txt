Game Shelf PWA v1.2.77 Release Notes
=====================================

Release Date: January 28, 2026

BATTLE SYSTEM FIXES:
--------------------
* Fixed critical double-counting bug
  - Logging same game twice no longer adds to score twice
  - Score now recalculates from all dailyScores (idempotent)
  
* Fixed race condition in rapid game logging
  - Multiple games logged quickly now all count correctly
  - Uses Firebase transactions for atomic updates

* Fixed prize pool calculation for token battles
  - Token stakes now correctly calculate prize pool
  - Was using entryFee (coins only) instead of stakeAmount

* Fixed winner payment currency
  - Coin battle winners now get coins back (not tokens)
  - Token battle winners get tokens back

* Fixed score conflict not updating battles
  - Replacing a score via conflict dialog now updates battle score

* Added battle reminder widget
  - Orange banner shows unplayed battle games: "‚ö†Ô∏è Still need: Wordle, Connections"
  - Clicking opens battle details

* Fixed daysPlayed tracking
  - Now correctly tracks unique days played in battles

NEW BATTLE STAKE UI (v1.2.76):
------------------------------
* Replaced dropdown with three buttons: Friendly | Coins | Tokens
* Coins: 1-5 coins max
* Tokens: 1-500 tokens max
* Simplified warning to single line

SERVER-SIDE SCORING (Firebase Functions):
-----------------------------------------
* New calculateBattleScore trigger recalculates scores authoritatively
* Battle type scoring now applied correctly:
  - Total Score: sum of all raw scores
  - Most Wins: 1 point per win
  - Perfect Hunter: 1 point per perfect score
  - Streak Challenge: raw scores + 10 pts per complete day
* New checkBattleCompletion hourly job auto-completes expired battles

TECHNICAL:
----------
* Client stores dailyMeta with won/perfect flags
* Server trigger recalculates based on battle type
* Firebase transactions prevent race conditions
* Prize distribution respects stakeType (coins vs tokens)

---

Game Shelf PWA v1.2.75 Release Notes
=====================================

Release Date: January 28, 2026

SOUND SYSTEM ENHANCEMENTS:
--------------------------
* Added new sound events:
  - "Coins to Wallet" (walletAdd) - plays when tokens added to wallet
  - "Hint Received" (hint) - plays when AI hint is displayed

* Added new sounds:
  - "Slot Machine Coins" (coinDrop) - cascading coin drop sound
  - "Lightbulb Moment" (lightbulb) - ascending sparkle for hints

* Added sounds to key moments:
  - AI hint received: plays "lightbulb" sound
  - Coin-to-token conversion: plays "coinDrop" sound
  - Five-day streak reward: plays "coinDrop" sound
  - All GS games reward: plays "coinDrop" sound
  - Battle participation tokens: plays "coinDrop" sound
  - Battle prize winnings: plays "coinDrop" sound
  - Referral rewards: plays "coinDrop" sound

---

Game Shelf PWA v1.2.74 Release Notes
=====================================

Release Date: January 28, 2026

BUG FIXES:
----------
* Fixed hint sign-in link not working
  - "Sign in ‚Üí" link in hint sheet now properly triggers Google sign-in
  - Previously it just navigated to the Hub tab
  - All three sign-in prompts in hint flow now work correctly

---

Game Shelf PWA v1.2.73 Release Notes
=====================================

Release Date: January 28, 2026

UX IMPROVEMENTS:
----------------
* Added mute reminder when previewing sounds
  - Shows "No sound? Check if your device is muted" after testing
  - Browsers cannot detect hardware mute state, so this helps users troubleshoot

---

Game Shelf PWA v1.2.72 Release Notes
=====================================

Release Date: January 28, 2026

BUG FIXES:
----------
* Fixed timezone bug in "played today" tracking
  - getTodayString() now uses local time instead of UTC
  - Previously, playing late at night (e.g., 11 PM ET) could record 
    the game as the next day in UTC, causing "already played" to 
    persist incorrectly after midnight local time
  - This affected all daily game tracking in Game Shelf

---

Game Shelf PWA v1.2.71 Release Notes
=====================================

Release Date: January 28, 2026

BUG FIXES:
----------
* Fixed clipboard error toast showing when game actually logs successfully
  - On iOS, "Could not read clipboard" no longer shows incorrectly
  - Clipboard read silently falls back to log sheet if needed
  - Games now log without confusing error messages

* Fixed sound not working on iOS
  - AudioContext now properly created and resumed on first user interaction
  - playSound now async - awaits resume() before playing
  - Added state logging for debugging
  - Sound should play after first tap/click on page

* Improved external game launch experience on iOS PWA
  - First-time tip shows how to return (tap ‚úï or swipe down)
  - Only shows once per device

* Removed "Feedback" banner from top-left corner
  - Banner no longer displays even when Feedback mode is on
  - Feedback button still works when mode is enabled

* Fixed double clipboard permission dialog on Record Game tap
  - Touch devices were triggering both touch and synthesized mouse events
  - Added guard to prevent handleRecordGame() from being called twice

* Menu now stays open when using functions
  - Tapping Sound Customizer, Launch Preferences, etc. no longer closes menu
  - Menu only closes when tapping outside or pressing X

TECHNICAL:
----------
* iOS clipboard handling no longer shows false error toasts
* SoundManager.playSound() and playEvent() now async
* AudioContext created and resumed on first touchstart/click gesture
* Added ensureResumed() method for explicit context resume
* Standalone PWA detection for iOS return navigation tip
* .uat-mode-badge hidden with display:none !important
* recordButtonHandled flag prevents touch+mouse double execution

---

Game Shelf PWA v1.2.69 Release Notes
=====================================

Release Date: January 27, 2026

SECURITY FIXES:
---------------
* Fixed remaining XSS vulnerability in public battles display
  - battle.name now properly escaped with escapeHtml()
  - battle.id escaped with escapeAttr() in onclick handlers

* Added input sanitization at source
  - New sanitizeTextInput() function strips HTML tags and dangerous chars
  - New isValidDisplayName() validator for display name format
  - Battle names sanitized before storing in database

TECHNICAL:
----------
* Defense in depth: escape on input AND output
* Battle name input limited to 30 chars, HTML stripped
* Display name validation: alphanumeric, spaces, basic punctuation only

---

Game Shelf PWA v1.2.68 Release Notes
=====================================

Release Date: January 27, 2026

SECURITY FIXES:
---------------
* Fixed XSS vulnerability in user-generated content display
  - Added escapeHtml() and escapeAttr() sanitization functions
  - 54 total sanitization points across the application
  
* User content areas patched:
  - Contact search results and friend addition
  - Friend cards, lists, and profiles
  - Leaderboard entries
  - Activity feed
  - Profile view headers and actions
  - Battle participants, standings, and results
  - Recommendation cards (challenge/nudge friend)
  - Account modal and menu account section
  - Game search "no results" message
  - Setup image upload preview
  - Battle impact tips

* Defense in depth applied to:
  - All displayName renders
  - All photoURL attributes
  - All onclick handler parameters with user IDs
  - Numeric values sanitized with parseInt()

TECHNICAL:
----------
* All user-controlled strings pass through HTML entity encoding
* URL attributes use attribute-safe encoding
* Numbers use parseInt() before display
* 54 escapeHtml/escapeAttr calls throughout codebase

---

Game Shelf PWA v1.2.67 Release Notes
=====================================

Release Date: January 27, 2026

NEW FEATURES:
-------------
* Reset Purchase Limits - New developer option in Settings
  - Clears purchase history after data reset
  - Allows re-testing the coin purchase flow
  - Only works when wallet is at default state (‚â§50 tokens, 0 coins)
  - Located in Settings ‚Üí Developer section

FIREBASE FUNCTIONS:
-------------------
* Added resetPurchaseHistory Cloud Function
  - Validates wallet state before allowing reset
  - Logs reset actions for audit trail

---

v1.2.66 Release Notes
=====================

Release Date: January 27, 2026

BUG FIXES:
----------
* Added try/catch to coin conversion for safer cloud sync
* Fixed forceRefresh promise chain error handling
* Fixed forceAppUpdate getRegistration error handling
* Fixed loadFromCloud auth restore error handling

TECHNICAL:
----------
* Error handling audit completed
* All async operations now have proper error handling
* Promise chains now have .catch() handlers

---

v1.2.65 Release Notes
=====================

Release Date: January 27, 2026

BUG FIXES:
----------
* Improved Firebase initialization with graceful fallback
  - App no longer crashes if Firebase SDK blocked (e.g., ad blockers)
  - Runs in offline mode when Firebase unavailable
* Fixed all clipboard operations to handle errors properly
  - All copy-to-clipboard now shows error if copy fails
  - Share dialog fallbacks work correctly

TECHNICAL:
----------
* Auth audit completed - all auth state checks consistent
* Promise error handling improved throughout

---

v1.2.64 Release Notes
=====================

BUG FIXES:
----------
* Fixed Transaction History "Sign in required" error when already signed in
  - Was checking wrong variable (window.firebaseUser instead of currentUser)
  - Was using wrong database reference (window.firebaseDB instead of db)

---

v1.2.63 Release Notes
=====================

NEW FEATURES:
-------------
* Transaction History - View your complete wallet activity
  - Coin purchases (amount, cost, date)
  - Token usage (AI hints)
  - Gift redemptions
  - Sorted by date (newest first)
  - Shows last 50 transactions

* Access via: Wallet ‚Üí "üìú Transaction History" button

NOTES:
------
* Requires Firebase Functions with Stripe integration
* Transaction data stored in Firebase Realtime Database
